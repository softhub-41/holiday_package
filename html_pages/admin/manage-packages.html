<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Manage Packages</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta name="description" content="Travelite - Tours and Travels Online Booking HTML"/>
    <meta name="keywords" content="Travel, html template, Travelite template">
    <meta name="MobileOptimized" content="320">
    <!-- font-awsome-link -->
    <link rel="stylesheet" href="/assets/css/all.min.css">
    <!--srart theme style -->
    <link href="/assets/css/main.css" rel="stylesheet" type="text/css"/>
    <!-- end theme style -->
    <!-- favicon links -->
    <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico"/>
    <link rel="icon" type="image/ico" href="/images/favicon.ico"/>
</head>
<body class="travel_home" onload="includeHTML(); get_hotels();get_packages();">
<div data-include-html="/admin-header"></div>
<!--Page main section start-->
<div id="travel_wrapper">
    <!--    <div></div>-->
    <!--content body start-->
    <div id="content_wrapper">
        <div class="clearfix"></div>
        <!-- Home first slider start -->
        <div class="slider_tab_main">

            <div class="full_width travelite_world_section">
                <div class="container">
                    <div class="row">
                        <div class="heading_team text-center">
                            <h3>Manage Packages</h3>
                        </div>
                    </div>
                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">
                        <i class="fa fa-add"></i>
                    </button>

                    <table class="table table-dark mt-2">
                        <thead>
                        <tr class="text-center">
                            <th>#</th>
                            <th>Hotel Name</th>
                            <th>Gold</th>
                            <th>Silver</th>
                            <th>Platinum</th>
                            <th colspan="2">Controls</th>
                        </tr>
                        </thead>
                        <tbody id="tdata"></tbody>
                    </table>
                </div>
            </div>
            <!-- counter section End -->

        </div>
        <!--content body end-->
        <!--footer start-->
        <div data-include-html="/footer"></div>
        <!--footer end-->
    </div>

    <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add new Package</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-10 offset-lg-1">
                            <h6 class="h5 text-danger text-center mb-3">* All packages will be valid for a year</h6>
                            <form id="addPackage">
                                <div class="row mb-2">
                                    <div class="col-lg-3 offset-lg-1">
                                        <label for="hotel_name">Hotel Name:</label>
                                    </div>
                                    <div class="col-lg-8">
                                        <select id="hotel_name" name="hotel_id" class="form-control"
                                                required data-msg-required="Hotel Name is required"></select>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-lg-3 offset-lg-1">
                                        <label for="gold">Gold:</label>
                                    </div>
                                    <div class="col-lg-8">
                                        <input id="gold" name="gold" class="form-control"
                                               required data-msg-required="Gold is required" data-rule-digits="true">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-lg-3 offset-lg-1">
                                        <label for="silver">Silver:</label>
                                    </div>
                                    <div class="col-lg-8">
                                        <input id="silver" name="silver" class="form-control"
                                               required data-msg-required="Silver is required" data-rule-digits="true">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-lg-3 offset-lg-1">
                                        <label for="platinum">Platinum:</label>
                                    </div>
                                    <div class="col-lg-8">
                                        <input id="platinum" name="platinum" class="form-control"
                                               required data-msg-required="Platinum is required"
                                               data-rule-digits="true">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-lg-4"></div>
                                    <div class="col-lg-8">
                                        <button type="button" onclick="add_package()" class="btn btn-primary">
                                            SUBMIT
                                        </button>
                                        <div id="res" class="mt-3"></div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="upModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Update Package</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-10 offset-lg-1">
                            <h6 class="h5 text-danger text-center mb-3">* All packages will be valid for a year</h6>
                            <form id="updatePackage">
                                <div class="row mb-2">
                                    <div class="col-lg-3 offset-lg-1">
                                        <input type="hidden" id="pck_id" name="pck_id"/>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-lg-3 offset-lg-1">
                                        <label for="ugold">Gold:</label>
                                    </div>
                                    <div class="col-lg-8">
                                        <input id="ugold" name="gold" class="form-control"
                                               required data-msg-required="Gold is required" data-rule-digits="true">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-lg-3 offset-lg-1">
                                        <label for="usilver">Silver:</label>
                                    </div>
                                    <div class="col-lg-8">
                                        <input id="usilver" name="silver" class="form-control"
                                               required data-msg-required="Silver is required" data-rule-digits="true">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-lg-3 offset-lg-1">
                                        <label for="uplatinum">Platinum:</label>
                                    </div>
                                    <div class="col-lg-8">
                                        <input id="uplatinum" name="platinum" class="form-control"
                                               required data-msg-required="Platinum is required"
                                               data-rule-digits="true">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-lg-4">
                                        <div id="res"></div>
                                    </div>
                                    <div class="col-lg-8">
                                        <button type="button" onclick="update_package()" class="btn btn-primary">
                                            SUBMIT
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="/assets/js/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/dist/jquery.validate.js"></script>
<script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/assets/js/bootstrap-select.js"></script>
<script type="text/javascript" src="/assets/js/plugin/datetimepicker/jquery.datetimepicker.js"></script>
<script type="text/javascript" src="/assets/js/plugin/revolution/js/revolution.extension.navigation.min.js">
</script>
<script type="text/javascript" src="/assets/js/plugin/revolution/js/revolution.extension.slideanims.min.js">
</script>
<script type="text/javascript" src="/assets/js/plugin/revolution/js/revolution.extension.actions.min.js">
</script>
<script type="text/javascript" src="/assets/js/plugin/revolution/js/revolution.extension.parallax.min.js">
</script>
<!-- REVOLUTION JS FiLES -->
<!-- video_popup -->
<script type="text/javascript" src="/assets/js/plugin/video-popup/jquery.magnific-popup.js">
</script>
<!-- video_popup -->
<!-- slick slider -->
<script type="text/javascript" src="/assets/js/plugin/slick/jquery-migrate-1.2.1.min.js">
</script>
<script type="text/javascript" src="/assets/js/plugin/slick/slick.min.js"></script>
<!-- slick slider -->
<!-- video player js -->
<script src="/assets/js/plugin/video_player/mediaelement-and-player.min.js"></script>
<!-- video player js -->
<!-- pricefilter -->
<script src="/assets/js/plugin/jquery-ui/jquery-ui.js"></script>
<!-- pricefilter-->
<script type="text/javascript" src="/assets/js/custom.js"></script>
<!--main js file end-->
<script>
    function includeHTML() {
        var z, i, elmnt, file, xhttp;
        /*loop through a collection of all HTML elements:*/
        z = document.getElementsByTagName("*");
        for (i = 0; i < z.length; i++) {
            elmnt = z[i];
            /*search for elements with a certain attribute:*/
            file = elmnt.getAttribute("data-include-html");
            if (file) {
                /*make an HTTP request using the attribute value as the file name:*/
                xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        if (this.status === 200) {
                            elmnt.innerHTML = this.responseText;
                        }
                        if (this.status === 404) {
                            elmnt.innerHTML = "Page not found.";
                        }
                        /*remove the attribute, and call this function once more:*/
                        elmnt.removeAttribute("data-include-html");
                        includeHTML();
                    }
                }
                xhttp.open("GET", file, true);
                xhttp.send();
                /*exit the function:*/
                return;
            }
        }
    }

    let get_hotels = () => {
        // alert();
        fetch("/get-hotels").then((response) => response.json()).then((value) => {
            // console.log(value);
            let output = "";
            let i = 0;
            if (value.length > 0) {
                output = "<option value=''>Please Select</button>"
                value.forEach((row) => {
                    output += "<option value='" + row.hotel_id + "'>" + row.hotel_name + " (" + row.name + ")</option>"

                })
            } else {
                output = "";
            }
            document.getElementById("hotel_name").innerHTML = output;
        })
    }

    let add_package = () => {
        $("#addPackage").validate();
        if ($("#addPackage").valid()) {
            var ele = document.getElementById("addPackage").elements;
            var formdata = new FormData();
            for (let i = 0; i < ele.length; i++) {
                if (ele[i].type !== "button")
                    formdata.append(ele[i].name, ele[i].value);
            }
            fetch("/add-package", {
                method: "post",
                body: formdata
            }).then((response) => response.text()).then((value) => {
                if (value === "exists") {
                    document.getElementById("res").innerHTML = "<span class='text-danger'>Package for hotel already exists</span>"
                } else {
                    get_packages();
                    document.getElementById("res").innerHTML = "<span class='text-success'>Package added successfully</span>"
                    document.getElementById("addPackage").reset();
                }
            })
        }
    }

    let get_packages = () => {
        fetch("/get-packages").then((response) => response.json()).then((value) => {
            console.log(value);
            let output = "";
            let i = 0;
            if (value.length > 0) {
                value.forEach((row) => {
                    output += "<tr class='text-center'>";
                    output += "<td>" + (++i) + "</td>";
                    output += "<td>" + row.hotel_name + "</td>";
                    output += "<td> &#x20b9; " + row.gold + "</td>";
                    output += "<td> &#x20b9; " + row.silver + "</td>";
                    output += "<td> &#x20b9; " + row.platinum + "</td>";

                    output += "<td><button type='button' onclick='fill_values(" + JSON.stringify(row) + ")' class='btn btn-warning btn-sm' data-bs-toggle='modal' data-bs-target='#upModal'><i class='fa fa-edit'></i> </button> </td>";
                    output += "<td><button type='button' class='btn btn-danger btn-sm'><i class='fa fa-times' onclick='del_package(" + JSON.stringify(row.pck_id) + ")'></i> </button> </td>";
                    output += "</tr>";
                })
            } else {
                output = "<tr><td colspan='7' class='alert alert-danger'>No data found</td></tr>";
            }
            document.getElementById("tdata").innerHTML = output;
        })
    }

    function del_package(packid) {
        // alert(packid)
        if (confirm("Are you sure ?")) {
            fetch("/del-package/" + packid).then((response) => response.text()).then((value) => {
                // console.log(value);
                if (value === "deleted") {
                    get_packages();
                }
            })
        }

    }

    function fill_values(row) {
        document.getElementById("ugold").value = row.gold;
        document.getElementById("usilver").value = row.silver;
        document.getElementById("uplatinum").value = row.platinum;
        document.getElementById("pck_id").value = row.pck_id;
    }

    function update_package() {
        $("#updatePackage").validate();
        if ($("#updatePackage").valid()) {
            var ele = document.getElementById("updatePackage").elements;
            var formdata = new FormData();
            for (let i = 0; i < ele.length; i++) {
                if (ele[i].type !== "button")
                    formdata.append(ele[i].name, ele[i].value);
            }
            fetch("/update-package", {
                method: "post",
                body: formdata
            }).then((response) => response.text()).then((value) => {
                console.log(value);
                if (value === "updated") {
                    get_packages()
                    alert(value)
                    $('#upModal').modal('hide')
                }
            })
        }
    }
</script>
</body>

</html>