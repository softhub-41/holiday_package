<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Travelite - Manage Cities</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta name="description" content="Travelite - Tours and Travels Online Booking HTML"/>
    <meta name="keywords" content="Travel, html template, Travelite template">
    <meta name="MobileOptimized" content="320">
    <!-- font-awsome-link -->
    <link rel="stylesheet" href="/assets/css/all.min.css">
    <!--srart theme style -->
    <link href="/assets/css/main.css" rel="stylesheet" type="text/css"/>
    <!-- end theme style -->
    <!-- favicon links -->
    <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico"/>
    <link rel="icon" type="image/ico" href="/images/favicon.ico"/>
</head>
<body class="travel_home" onload="includeHTML();get_cities();">
<div data-include-html="/admin-header"></div>
<!--Page main section start-->
<div id="travel_wrapper">
    <div></div>
    <!-- content body start -->
    <div id="content_wrapper">
        <div class="clearfix"></div>
        <!-- Home first slider start -->
        <div class="slider_tab_main">

            <div class="full_width travelite_world_section">
                <div class="container">
                    <div class="row">

                        <div class="heading_team text-center">
                            <h3>Manage Cities</h3>
                        </div>
                    </div>
                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">
                        <i class="fa fa-add"></i>
                    </button>

                    <table class="table table-dark mt-2">
                        <thead>
                        <tr class="text-center">
                            <th>Sr. No.</th>
                            <th>Name</th>
                            <th>Pin Code</th>
                            <th>State</th>
                            <th colspan="2">Controls</th>
                        </tr>
                        </thead>
                        <tbody id="tdata">

                        </tbody>
                    </table>
                </div>
            </div>
            <!-- counter section End -->

        </div>
        <!--content body end-->
        <!--footer start-->
        <div data-include-html="/footer"></div>
        <!--footer end-->

    </div>

    <!--  ADD  -->
    <div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New City</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-10 offset-lg-1">
                            <form id="addcity">
                                <div class="mb-3">
                                    <label for="state">State</label>
                                    <select name="state" id="state" class="form-control" required
                                            data-msg-required="State is required">
                                        <option value="">Please Select</option>
                                        <option>Punjab</option>
                                        <option>Haryana</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="city">City Name</label>
                                    <input type="text" id="city" name="city" required class="form-control"
                                           data-msg-required="City Name is required" placeholder="e.g. Amritsar">
                                </div>
                                <div class="mb-3">
                                    <label for="pin_code">Pin Code</label>
                                    <input type="text" id="pin_code" name="pin_code" class="form-control" required
                                           data-rule-digits="true" data-msg-required="Pin Code is required" placeholder="e.g. 143001">
                                </div>
                                <div class="mb-2">
                                    <button type="button" onclick="addcity()" class="btn btn-primary">SUBMIT</button>
                                    <div id="errmsg"></div>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!--  EDIT  -->
    <div class="modal fade" id="upModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Update City</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-10 offset-lg-1">
                            <form id="upcity">
                                <input type="hidden" id="cityid" name="cityid"/>
                                <div class="mb-3">
                                    <label for="ustate">State:</label>
                                    <select name="state" id="ustate" class="form-control">
                                        <!--                                        <option value="">Select:</option>-->
                                        <option>Punjab</option>
                                        <option>Haryana</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="ucity">City Name:</label>
                                    <input type="text" id="ucity" name="city" required class="form-control"
                                           data-msg-required="City name is required">
                                </div>
                                <div class="mb-3">
                                    <label for="upin_code">Pin Code:</label>
                                    <input type="text" id="upin_code" name="pin_code" class="form-control" required
                                           data-rule-digits="true" data-msg-required="Pin Code is required">
                                </div>
                                <div class="mb-2">
                                    <button type="button" onclick="upcity()" class="btn btn-primary">SUBMIT</button>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="/assets/js/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/dist/jquery.validate.js"></script>
<script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/assets/js/bootstrap-select.js"></script>
<script type="text/javascript" src="/assets/js/plugin/datetimepicker/jquery.datetimepicker.js"></script>
<script type="text/javascript" src="/assets/js/plugin/revolution/js/revolution.extension.navigation.min.js">
</script>
<script type="text/javascript" src="/assets/js/plugin/revolution/js/revolution.extension.slideanims.min.js">
</script>
<script type="text/javascript" src="/assets/js/plugin/revolution/js/revolution.extension.actions.min.js">
</script>
<script type="text/javascript" src="/assets/js/plugin/revolution/js/revolution.extension.parallax.min.js">
</script>
<!-- REVOLUTION JS FiLES -->
<!-- video_popup -->
<script type="text/javascript" src="/assets/js/plugin/video-popup/jquery.magnific-popup.js">
</script>
<!-- video_popup -->
<!-- slick slider -->
<script type="text/javascript" src="/assets/js/plugin/slick/jquery-migrate-1.2.1.min.js">
</script>
<script type="text/javascript" src="/assets/js/plugin/slick/slick.min.js"></script>
<!-- slick slider -->
<!-- video player js -->
<script src="/assets/js/plugin/video_player/mediaelement-and-player.min.js"></script>
<!-- video player js -->
<!-- pricefilter -->
<script src="/assets/js/plugin/jquery-ui/jquery-ui.js"></script>
<!-- pricefilter -->
<script type="text/javascript" src="/assets/js/custom.js"></script>
<!-- main js file end -->

<script>
    function includeHTML() {
        var z, i, elmnt, file, xhttp;
        /*loop through a collection of all HTML elements:*/
        z = document.getElementsByTagName("*");
        for (i = 0; i < z.length; i++) {
            elmnt = z[i];
            /*search for elements with a certain attribute:*/
            file = elmnt.getAttribute("data-include-html");
            if (file) {
                /*make an HTTP request using the attribute value as the file name:*/
                xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        if (this.status === 200) {
                            elmnt.innerHTML = this.responseText;
                        }
                        if (this.status === 404) {
                            elmnt.innerHTML = "Page not found.";
                        }
                        /*remove the attribute, and call this function once more:*/
                        elmnt.removeAttribute("data-include-html");
                        includeHTML();
                    }
                }
                xhttp.open("GET", file, true);
                xhttp.send();
                /*exit the function:*/
                return;
            }
        }
    }

    function addcity() {
        // $("#addcity").validate();
        if ($("#addcity").valid()) {
            var ele = document.getElementById("addcity").elements;
            var formdata = new FormData();
            for (let i = 0; i < ele.length; i++) {
                if (ele[i].type !== "button") {
                    formdata.append(ele[i].name, ele[i].value);
                }
            }
            fetch("/add-city", {
                method: "post",
                body: formdata
            }).then((response) => response.text()).then((value) => {
                if (value === "inserted") {
                    get_cities()
                    document.getElementById("errmsg").innerHTML = "<div class='alert alert-success mt-3'>New city added successfully</div>";
                    document.getElementById("addcity").reset();
                } else {
                    document.getElementById("errmsg").innerHTML = "<div class='alert alert-danger mt-3'>City already exists</div>";

                }
            })
        }
    }

    let get_cities = () => {
        fetch("/get-cities").then((response) => response.json()).then((value) => {
            // console.log(value)
            if (value.length > 0) {
                let output = "";
                let i = 0;
                value.forEach((row) => {
                    output += "<tr class='text-center'>"
                    output += "<td>" + (++i) + "</td>"
                    output += "<td class='text-capitalize'>" + row.name + "</td>"
                    output += "<td>" + row.pincode + "</td>"
                    output += "<td>" + row.state + "</td>"
                    output += "<td><button type='button' class='btn btn-warning' data-bs-toggle='modal' data-bs-target='#upModal' onclick='getcitydata(" + JSON.stringify(row) + ")'><i class='fa fa-edit'></i> </button> </td>"
                    output += "<td><button type='button' class='btn btn-danger' onclick='del_city(" + JSON.stringify(row.city_id) + ")'><i class='fa fa-remove'></i> </button> </td>"

                    output += "</tr>";
                })
                document.getElementById("tdata").innerHTML = output
            }
        })
    }

    function getcitydata(row) {
        document.getElementById("ucity").value = row.name;
        document.getElementById("upin_code").value = row.pincode;
        document.getElementById("cityid").value = row.city_id;
        var st = document.getElementById("ustate").value;
        var slt = "";
        if (st === "Punjab") {
            slt += "<option selected>Punjab</option><option >Haryana</option>"
        } else {
            slt += "<option >Punjab</option><option selected>Haryana</option>"
        }
        document.getElementById("ustate").innerHTML = slt;
    }

    let upcity = () => {
        $("#upcity").validate();
        if ($("#upcity").valid()) {
            var ele = document.getElementById("upcity").elements;
            var formdata = new FormData();
            for (let i = 0; i < ele.length; i++) {
                if (ele[i].type !== "button") {
                    formdata.append(ele[i].name, ele[i].value);
                }
            }
            fetch("/up-city", {
                method: "post",
                body: formdata
            }).then((response) => response.text()).then((value) => {
                console.log(value);
                if (value === "updated") {
                    get_cities();
                    $("#upModal").modal("hide")
                }
            })
        }
    }

    let del_city = (city_id) => {
        if (confirm('Are you sure ?')) {
            fetch("/del-city/" + city_id).then((response) => response.text()).then((value) => {
                console.log(value);
                get_cities();
            })
        }
    }
</script>
</body>

</html>